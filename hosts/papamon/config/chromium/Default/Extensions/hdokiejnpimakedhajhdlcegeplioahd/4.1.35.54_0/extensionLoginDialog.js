var ExtensionLoginDialog=function(a){LoginDialog.call(this,a,{closeButtonEnabled:!1});this.populatedSavedLogin=!1;(function(a){a.savedLoginCallback=function(b){for(var c=[],d=0,h=b.length;d<h;++d){var e=b[d].username;c.push({value:e,label:e})}a.inputFields.email.setOptions(c);0<b.length?(c=b[0],a.data.savedLogins=b,a.inputFields.email.setValue(c.username),a.inputFields.password.focus()):a.inputFields.email.focus()};a.browserPasswordManagerCallback=function(){$("#loginDialogDisablePasswordManagerContainer").show();
a.inputFields.disablePasswordManager.setValue(bg.Preferences.get("disableffpwasked"))}})(this)};ExtensionLoginDialog.prototype=Object.create(LoginDialog.prototype);ExtensionLoginDialog.prototype.constructor=ExtensionLoginDialog;
(function(){ExtensionLoginDialog.prototype.populateSavedLogin=function(a){this.inputFields.password.setValue(a);this.inputFields.rememberPassword.setValue(""!==a);this.populatedSavedLogin=!0};ExtensionLoginDialog.prototype.parseSavedLogin=function(a){switch(a["protected"]){case 0:this.populateSavedLogin(a.password);break;case 1:bg.unprotect_data(a.password,!1,this.createDynamicHandler(function(a){this.populateSavedLogin(a)}));break;case 2:this.populateSavedLogin(bg.lpdec(a.password,bg.AES.hex2bin(bg.SHA256(a.username))))}};
ExtensionLoginDialog.prototype.initialize=function(a){LoginDialog.prototype.initialize.apply(this,arguments);this.inputFields.rememberPassword.getElement().bind("click",function(b){var a=!1,d=function(){a=!0;b.inputFields.rememberPassword.setValue(!0)};return function(){var c=b.inputFields.rememberPassword.getValue();!a&&c?(dialogs.confirmation.open({title:Strings.translateString("Are you sure?"),text:Strings.translateString("Using 'remember password' makes it easier to forget your password and decreases your security if your device is infected or stolen."),
handler:d,onResize:b.data.onResize}),b.inputFields.rememberPassword.setValue(!1)):a=!1}}(this));var f=function(b){var a;return function(d){var c=b.populatedSavedLogin;b.populatedSavedLogin=!1;if(b.data.savedLogins)for(var e=0,f=b.data.savedLogins.length;e<f;++e){var g=b.data.savedLogins[e];if(g.username===d){b.parseSavedLogin(g);break}}c&&!b.populatedSavedLogin&&(b.inputFields.password.clear(),b.inputFields.rememberPassword.clear());c=a;d&&bg.localStorage_getItem(bg.SHA256(d)+".noremember")?($("#ExtensionLoginDialogRememberPasswordContainer").hide(),
a=!1):($("#ExtensionLoginDialogRememberPasswordContainer").show(),a=!0);a!==c&&b.setDynamicHeight()}}(this);this.inputFields.email.onChange(f);this.inputFields.email.inputObject.onChange(f)};ExtensionLoginDialog.prototype.setup=function(){LoginDialog.prototype.setup.apply(this,arguments);bg.get_saved_logins(this.savedLoginCallback);LPPlatform.checkBrowserPasswordManager(this.browserPasswordManagerCallback)};ExtensionLoginDialog.prototype.open=function(a){LoginDialog.prototype.open.call(this,$.extend(a,
{defaultData:{rememberEmail:bg.Preferences.get("rememberemail"),rememberPassword:bg.Preferences.get("rememberpassword"),rememberShowVault:bg.Preferences.get("showvault")}}))};ExtensionLoginDialog.prototype.handleSubmit=function(){var a=null,f=function(b){null===a&&(a=setInterval(function(){"undefined"===typeof VaultState&&bg.getData&&bg.getData({context:"login"});bg.get("lploggedin")&&(clearInterval(a),a=null,b.close())},1E3))};return function(a){a.email=bg.fix_username(a.email);bg.Preferences.set({rememberemail:a.rememberEmail,
rememberpassword:a.rememberPassword,showvault:a.rememberShowVault});a.disablePasswordManager&&bg.disablepasswordmanager(!0);bg.make_lp_key_hash(a.email,a.password,function(b,d){return function(c,e){b.set("g_manual_login",!0);b.LP_do_login(a.email,a.password,a.rememberEmail,a.rememberPassword,null,a.rememberShowVault,c,e);d.data.isPopup&&d.close()}}(bg,this));this.data.isPopup||f(this)}}()})();
